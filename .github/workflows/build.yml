name: üß± Build and Test ProgramEle (Qt 6)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # --- Pobranie repozytorium ---
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- Instalacja ≈õrodowiska Qt6 i narzƒôdzi budowania ---
      - name: Install Qt6 and dependencies
        run: |
          sudo apt update
          sudo apt install -y \
            qt6-base-dev \
            qt6-base-dev-tools \
            qt6-tools-dev \
            qt6-tools-dev-tools \
            qt6-declarative-dev \
            qt6-pdf-dev \
            cmake ninja-build g++

      # --- Diagnostyka Qt (opcjonalna, poka≈ºe gdzie Qt jest zainstalowany) ---
      - name: Verify Qt installation
        run: |
          qmake6 -v || echo "‚ö†Ô∏è qmake6 not found (ok if using pure CMake)"
          ls -l /usr/lib/x86_64-linux-gnu/cmake/Qt6* || true

      # --- Konfiguracja projektu przez CMake ---
      - name: Configure project (CMake)
        run: |
          cmake -S . -B build -G Ninja \
            -DCMAKE_BUILD_TYPE=Release \
            -DCMAKE_PREFIX_PATH=/usr/lib/x86_64-linux-gnu/cmake/Qt6

      # --- Kompilacja projektu ---
      - name: Build project
        run: |
          cmake --build build --parallel
          echo "‚úÖ ProgramEle built successfully"

      # --- (Opcjonalnie) Test uruchomienia binarki ---
      - name: Run built binary (headless test)
        run: |
          if [ -f build/ProgramEle ]; then
            echo "Binary found, running smoke test..."
            xvfb-run -a ./build/ProgramEle --version || echo "No CLI output (GUI app)"
          else
            echo "‚ö†Ô∏è Binary not found after build!"
            ls -R build
          fi

      # --- Zako≈Ñczenie ---
      - name: Build finished
        run: echo "üéâ Qt6 build & test pipeline completed successfully!"
